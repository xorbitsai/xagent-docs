import { z } from 'zod';
import { normalizeUrl } from './href.js';
const ALLOWED_PROTOCOLS = ['https:'];
const DANGEROUS_FILE_EXTENSIONS = ['.svg', '.exe', '.zip'];
/**
 * Allows only safe absolute URLs (https), while blocking dangerous file extensions.
 * Relative paths and mailto links are not allowed.
 */
export const secureUrlSchema = z
    .string()
    .url()
    .transform(normalizeUrl)
    .refine((value) => {
    try {
        const url = new URL(value);
        const isAllowedProtocol = ALLOWED_PROTOCOLS.includes(url.protocol);
        const decodedPathname = decodeURIComponent(url.pathname).toLowerCase();
        const isSafeExtension = !DANGEROUS_FILE_EXTENSIONS.some((ext) => decodedPathname.endsWith(ext));
        return isAllowedProtocol && isSafeExtension;
    }
    catch (_a) {
        return false;
    }
}, { message: 'Must be a valid HTTPS URL.' });
